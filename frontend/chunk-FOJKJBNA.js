import{a as G}from"./chunk-XGPTB53O.js";import{b as W,c as q,d as R,e as B,f as Q,g as H,l as Y,m as $}from"./chunk-O3S2I4IV.js";import{$ as y,C as s,F as C,G as I,Ha as P,Ia as j,K as x,O as p,P as t,Q as r,R as _,S as v,T as u,U as d,W as L,Y as V,Z as i,_ as f,ea as M,fa as h,ga as O,ja as U,la as k,m as S,na as z,p as E,r as m,ra as T,s as g,sa as N,ua as A,w as b,wa as F,ya as D}from"./chunk-ZDDN4IUL.js";var w=class l{constructor(n){this.http=n}apiUrl=`${P.apiUrl}/auth/users`;getUsers(){return this.http.get(this.apiUrl)}getUser(n){return this.http.get(`${this.apiUrl}/${n}`)}createUser(n){return this.http.post(`${P.apiUrl}/auth/register`,n)}deleteUser(n){return this.http.delete(`${this.apiUrl}/${n}`)}changePassword(n){return this.http.post(`${P.apiUrl}/auth/change-password`,n)}static \u0275fac=function(e){return new(e||l)(E(D))};static \u0275prov=S({token:l,factory:l.\u0275fac,providedIn:"root"})};function X(l,n){l&1&&(t(0,"div",22),_(1,"i",23),t(2,"p"),i(3,"Cargando usuarios..."),r()())}function ee(l,n){if(l&1){let e=v();t(0,"div",24),_(1,"i",25),t(2,"p"),i(3),r(),t(4,"button",26),u("click",function(){m(e);let a=d();return g(a.loadUsers())}),_(5,"i",27),i(6," Reintentar "),r()()}if(l&2){let e=d();s(3),f(e.error())}}function te(l,n){if(l&1){let e=v();t(0,"tr",31)(1,"td")(2,"div",32)(3,"div",33),i(4),r(),t(5,"div",34)(6,"span",35),i(7),r(),t(8,"span",36),i(9),r()()()(),t(10,"td")(11,"span",37),i(12),r()(),t(13,"td")(14,"span",38),i(15),U(16,"date"),r()(),t(17,"td")(18,"span",38),i(19),U(20,"date"),r()(),t(21,"td",29)(22,"div",39)(23,"button",40),u("click",function(){let a=m(e).$implicit,c=d(2);return g(c.deleteUser(a))}),_(24,"i",41),r()()()()}if(l&2){let e=n.$implicit,o=d(2);s(3),L("background-color",o.getAvatarColor(e.username)),s(),y(" ",e.username[0].toUpperCase()," "),s(3),f(e.username),s(2),f(e.id),s(2),V(e.role||"admin"),s(),y(" ",e.role||"Admin"," "),s(3),f(k(16,11,e.created_at,"medium")),s(4),f(k(20,14,e.updated_at,"medium")),s(4),p("disabled",o.isCurrentUser(e))}}function ne(l,n){if(l&1&&(t(0,"table",28)(1,"thead")(2,"tr")(3,"th"),i(4,"USUARIO"),r(),t(5,"th"),i(6,"ROL"),r(),t(7,"th"),i(8,"FECHA CREACI\xD3N"),r(),t(9,"th"),i(10,"\xDALTIMA ACTUALIZACI\xD3N"),r(),t(11,"th",29),i(12,"ACCIONES"),r()()(),t(13,"tbody"),x(14,te,25,17,"tr",30),r()()),l&2){let e=d();s(14),p("ngForOf",e.filteredUsers())}}function re(l,n){l&1&&(t(0,"div",42)(1,"p"),i(2,"No se encontraron usuarios."),r()())}function oe(l,n){if(l&1){let e=v();t(0,"div",43),u("click",function(){m(e);let a=d();return g(a.showCreateForm=!1)}),t(1,"div",44),u("click",function(a){return m(e),g(a.stopPropagation())}),t(2,"div",45)(3,"h2"),i(4,"Crear Nuevo Usuario"),r(),t(5,"button",46),u("click",function(){m(e);let a=d();return g(a.showCreateForm=!1)}),i(6,"\xD7"),r()(),t(7,"form",47),u("submit",function(a){m(e);let c=d();return g(c.createUser(a))}),t(8,"div",48)(9,"label",49),i(10,"Nombre de Usuario"),r(),t(11,"input",50),O("ngModelChange",function(a){m(e);let c=d();return h(c.newUser.username,a)||(c.newUser.username=a),g(a)}),r()(),t(12,"div",48)(13,"label",51),i(14,"Contrase\xF1a"),r(),t(15,"input",52),O("ngModelChange",function(a){m(e);let c=d();return h(c.newUser.password,a)||(c.newUser.password=a),g(a)}),r()(),t(16,"div",53)(17,"button",54),u("click",function(){m(e);let a=d();return g(a.showCreateForm=!1)}),i(18,"Cancelar"),r(),t(19,"button",55),i(20,"Crear Usuario"),r()()()()()}if(l&2){let e=d();s(11),M("ngModel",e.newUser.username),s(4),M("ngModel",e.newUser.password),s(4),p("disabled",!e.isFormValid())}}var Z=class l{constructor(n,e,o){this.userService=n;this.dialogService=e;this.authService=o}users=b([]);searchQuery="";showCreateForm=!1;newUser={username:"",password:""};loading=b(!1);error=b(null);filteredUsers=z(()=>{let n=this.searchQuery.toLowerCase();return this.users().filter(e=>e.username.toLowerCase().includes(n))});ngOnInit(){this.loadUsers()}loadUsers(){this.loading.set(!0),this.error.set(null),this.userService.getUsers().subscribe({next:n=>{this.users.set(n),this.loading.set(!1),this.error.set(null)},error:n=>{console.error("Error al cargar usuarios:",n),this.loading.set(!1),this.error.set(n.error?.message||"Error al cargar la lista de usuarios. Por favor, intenta de nuevo.")}})}isCurrentUser(n){return this.authService.currentUser()?.id===n.id}getAdminCount(){return this.users().filter(n=>(n.role||"admin")==="admin").length}getAvatarColor(n){let e=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],o=n.length%e.length;return e[o]}async deleteUser(n){await this.dialogService.confirm({title:"Eliminar Usuario",message:`\xBFEst\xE1s seguro de que deseas eliminar al usuario "${n.username}"? Esta acci\xF3n no se puede deshacer.`,confirmText:"Eliminar",type:"danger"})&&this.userService.deleteUser(n.id).subscribe({next:()=>{this.loadUsers()},error:o=>{console.error("Error al eliminar usuario:",o),alert("Error al eliminar usuario: "+(o.error?.message||"Error desconocido"))}})}isFormValid(){return this.newUser.username.length>=3&&this.newUser.password.length>=6}createUser(n){n.preventDefault(),this.isFormValid()&&this.userService.createUser(this.newUser).subscribe({next:()=>{this.loadUsers(),this.showCreateForm=!1,this.newUser={username:"",password:""}},error:e=>{alert("Error al crear usuario: "+(e.error?.message||"Error desconocido"))}})}static \u0275fac=function(e){return new(e||l)(C(w),C(G),C(j))};static \u0275cmp=I({type:l,selectors:[["app-user-list"]],decls:32,vars:8,consts:[[1,"user-list-container"],[1,"header-section"],[1,"title-area"],[1,"subtitle"],[1,"actions-group"],[1,"btn-add",3,"click"],[1,"fa-solid","fa-plus"],[1,"stats-row"],[1,"stat-card"],[1,"value"],[1,"label"],[1,"value","success"],[1,"filters-bar","glass"],[1,"search-box"],[1,"fa-solid","fa-magnifying-glass","search-icon"],["type","text","placeholder","Buscar por nombre de usuario...",3,"ngModelChange","ngModel"],[1,"table-card"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","user-table",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"loading-state"],[1,"fa-solid","fa-spinner","fa-spin"],[1,"error-state"],[1,"fa-solid","fa-triangle-exclamation"],[1,"btn-retry",3,"click"],[1,"fa-solid","fa-rotate-right"],[1,"user-table"],[1,"actions-cell"],["class","user-row",4,"ngFor","ngForOf"],[1,"user-row"],[1,"user-info-cell"],[1,"avatar"],[1,"info-text"],[1,"name"],[1,"subtext"],[1,"role-pill"],[1,"date-text"],[1,"action-buttons"],["title","Eliminar",1,"icon-btn-plain","danger",3,"click","disabled"],[1,"fa-solid","fa-trash"],[1,"empty-state"],[1,"modal-overlay",3,"click"],[1,"modal-content","glass",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"user-form",3,"submit"],[1,"form-group"],["for","username"],["type","text","id","username","name","username","required","","placeholder","Ej: admin_alt",3,"ngModelChange","ngModel"],["for","password"],["type","password","id","password","name","password","required","","placeholder","M\xEDnimo 6 caracteres",3,"ngModelChange","ngModel"],[1,"form-actions"],["type","button",1,"btn-cancel",3,"click"],["type","submit",1,"btn-submit",3,"disabled"]],template:function(e,o){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),i(4,"Usuarios"),r(),t(5,"p",3),i(6,"Administrar los usuarios con acceso al panel de control"),r()(),t(7,"div",4)(8,"button",5),u("click",function(){return o.showCreateForm=!0}),_(9,"i",6),i(10," Nuevo Usuario "),r()()(),t(11,"div",7)(12,"div",8)(13,"span",9),i(14),r(),t(15,"span",10),i(16,"Total Usuarios"),r()(),t(17,"div",8)(18,"span",11),i(19),r(),t(20,"span",10),i(21,"Administradores"),r()()(),t(22,"div",12)(23,"div",13),_(24,"i",14),t(25,"input",15),O("ngModelChange",function(c){return h(o.searchQuery,c)||(o.searchQuery=c),c}),r()()(),t(26,"div",16),x(27,X,4,0,"div",17)(28,ee,7,1,"div",18)(29,ne,15,1,"table",19)(30,re,3,0,"div",20),r()(),x(31,oe,21,3,"div",21)),e&2&&(s(14),f(o.users().length),s(5),f(o.getAdminCount()),s(6),M("ngModel",o.searchQuery),s(2),p("ngIf",o.loading()),s(),p("ngIf",o.error()&&!o.loading()),s(),p("ngIf",!o.loading()&&!o.error()),s(),p("ngIf",!o.loading()&&!o.error()&&o.users().length===0),s(),p("ngIf",o.showCreateForm))},dependencies:[F,T,N,$,H,W,q,R,Y,Q,B,A],styles:[".user-list-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.header-section[_ngcontent-%COMP%]   .title-area[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;margin-bottom:.25rem}.header-section[_ngcontent-%COMP%]   .title-area[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:var(--text-muted);font-size:.95rem}.btn-add[_ngcontent-%COMP%]{background:#0f172a;color:#fff;font-weight:600;padding:.75rem 1.25rem;border-radius:10px}.btn-add[_ngcontent-%COMP%]:hover{background:#1e293b}.stats-row[_ngcontent-%COMP%]{display:flex;gap:1.5rem}.stat-card[_ngcontent-%COMP%]{background:var(--surface);padding:1.5rem;border-radius:12px;border:1px solid var(--border);display:flex;flex-direction:column;gap:.5rem;min-width:200px}.stat-card[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--text)}.stat-card[_ngcontent-%COMP%]   .value.success[_ngcontent-%COMP%]{color:#22c55e}.stat-card[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:#94a3b8;text-transform:uppercase;letter-spacing:.5px}.filters-bar[_ngcontent-%COMP%]{padding:1rem 1.5rem;background:var(--surface);border:1px solid var(--border);border-radius:12px}.filters-bar[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.filters-bar[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;background:transparent;width:100%;padding:.5rem;font-size:.95rem;color:var(--text)}.filters-bar[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none}.filters-bar[_ngcontent-%COMP%]   .search-box[_ngcontent-%COMP%]   .search-icon[_ngcontent-%COMP%]{color:#94a3b8}.table-card[_ngcontent-%COMP%]{background:var(--surface);border-radius:12px;border:1px solid var(--border);overflow:hidden}.user-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.user-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:1rem 1.5rem;text-align:left;font-size:.7rem;font-weight:700;color:#94a3b8;text-transform:uppercase;letter-spacing:1px;border-bottom:1px solid var(--border)}.user-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);vertical-align:middle}.user-row[_ngcontent-%COMP%]{transition:background .2s}.user-row[_ngcontent-%COMP%]:hover{background:#f8fafc}.user-info-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.user-info-cell[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:1rem}.user-info-cell[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-info-cell[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;color:var(--text);font-size:.95rem}.user-info-cell[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]   .subtext[_ngcontent-%COMP%]{font-size:.75rem;color:#94a3b8;font-family:monospace}.role-pill[_ngcontent-%COMP%]{display:inline-flex;padding:.25rem .75rem;border-radius:20px;font-size:.75rem;font-weight:700;background:#eff6ff;color:#1e40af}.role-pill.admin[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.date-text[_ngcontent-%COMP%]{font-size:.85rem;color:#64748b}.actions-cell[_ngcontent-%COMP%]{text-align:right}.action-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem}.icon-btn-plain[_ngcontent-%COMP%]{background:transparent;border:none;width:32px;height:32px;display:flex;align-items:center;justify-content:center;color:#94a3b8;font-size:1.1rem;border-radius:6px}.icon-btn-plain[_ngcontent-%COMP%]:hover:not(:disabled){background:#f1f5f9;color:var(--text)}.icon-btn-plain.danger[_ngcontent-%COMP%]:hover:not(:disabled){background:#fef2f2;color:#ef4444}.icon-btn-plain[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:4rem;color:#94a3b8}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem;gap:1rem;color:#94a3b8}.loading-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:#6366f1}.loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.95rem}.error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem;gap:1rem;color:#ef4444;text-align:center}.error-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.5rem;color:#ef4444}.error-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.95rem;color:var(--text);max-width:500px}.error-state[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]{margin-top:.5rem;background:#6366f1;color:#fff;border:none;padding:.75rem 1.5rem;border-radius:8px;font-weight:600;font-size:.9rem;cursor:pointer;display:flex;align-items:center;gap:.5rem;transition:all .2s}.error-state[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]:hover{background:#4f46e5;transform:translateY(-1px)}.error-state[_ngcontent-%COMP%]   .btn-retry[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.9rem;color:#fff}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#0006;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1000;animation:_ngcontent-%COMP%_fadeIn .2s ease}.modal-content[_ngcontent-%COMP%]{background:var(--surface);width:90%;max-width:450px;border-radius:20px;padding:2rem;box-shadow:0 20px 40px #0003;animation:_ngcontent-%COMP%_slideUp .3s cubic-bezier(.34,1.56,.64,1);border:1px solid var(--border);display:flex;flex-direction:column;gap:1.5rem}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:var(--text);display:flex;align-items:center;gap:.75rem}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{font-size:1.5rem;background:transparent;border:none;color:var(--text-muted);cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:all .2s}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]:hover{background:var(--border);color:var(--text)}.user-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--text)}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.75rem 1rem;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:.9rem;transition:all .2s}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px #6366f11a}.form-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:.5rem;padding-top:1rem;border-top:1px solid var(--border)}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;padding:.75rem 1.5rem;border-radius:12px;font-weight:600;font-size:.9rem;cursor:pointer;transition:all .2s;border:none}.form-actions[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%]{background:var(--surface);color:var(--text-muted);border:1px solid var(--border)}.form-actions[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%]:hover{background:var(--border);color:var(--text)}.form-actions[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]{background:#6366f1;color:#fff}.form-actions[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){background:#4f46e5;transform:translateY(-1px);box-shadow:0 4px 12px #6366f14d}.form-actions[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideUp{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.dark[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%], .dark[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%], .dark[_ngcontent-%COMP%]   .filters-bar[_ngcontent-%COMP%], .dark[_ngcontent-%COMP%]   .modal-content[_ngcontent-%COMP%]{background:#111827;border-color:#1f2937}.dark[_ngcontent-%COMP%]   .user-row[_ngcontent-%COMP%]:hover{background:#1e293b}.dark[_ngcontent-%COMP%]   .btn-add[_ngcontent-%COMP%]{background:#f8fafc;color:#0f172a}.dark[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]{background:#6366f1;color:#fff}.dark[_ngcontent-%COMP%]   .btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){background:#4f46e5}.dark[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%]{background:#1f2937;color:#94a3b8;border-color:#374151}.dark[_ngcontent-%COMP%]   .btn-cancel[_ngcontent-%COMP%]:hover{background:#374151;color:#fff}"]})};export{Z as UserListComponent};
