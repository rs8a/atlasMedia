import{a as V,b as q,c as J,d as G,e as H,f as Q,g as W,h as X,i as Y,l as Z}from"./chunk-7RZWTPM2.js";import{a as et}from"./chunk-FMJ76REX.js";import{a as tt}from"./chunk-FEXXS4L7.js";import{$ as p,C as i,Da as $,F as I,G as z,Ga as E,K as A,O as y,P as t,Q as e,R as s,U as N,W as S,X as T,Y as B,Z as n,_ as d,a as M,b as P,ia as F,ka as L,ma as _,q as w,qa as U,ua as j,va as K,w as D,x as R}from"./chunk-YAHRTPNZ.js";function rt(f,o){if(f&1&&(t(0,"tr")(1,"td")(2,"div",43)(3,"div",44),n(4),e(),t(5,"div",45)(6,"span",46),n(7),e(),t(8,"span",47),n(9),e()()()(),t(10,"td")(11,"span",48),s(12,"i",49),n(13),e()(),t(14,"td")(15,"span",50),s(16,"i",51),n(17),e()()()),f&2){let a=o.$implicit,r=N();i(3),S("background",r.getAvatarColor(a.name)),i(),d(a.name[0].toUpperCase()),i(3),d(a.name),i(2),d(a.slug),i(2),B(a.status),i(2),p(" ",a.status==="running"?"Activo":a.status==="error"?"Error":"Detenido"," "),i(2),T("active",a.bitrate!=="0 Kbps"),i(2),p(" ",a.bitrate||"0 Kbps"," ")}}V.register(X,Y,J,q,Q,W,H,G);var nt=class f{constructor(o){this.channelService=o;R(()=>{let a=this.socketService.allStats();a.length>0&&this.updateCharts(a)})}channels=D([]);socketService=w(tt);apiUrlDisplay=_(()=>{try{let o=new URL(E.apiUrl);return o.hostname+(o.port?`:${o.port}`:"")}catch{return E.apiUrl}});liveChannels=_(()=>{let o=this.socketService.allStats(),a=this.channels();return o.filter(c=>c.process?.isRunning===!0).map(c=>{let u=c.channel?.id,b=a.find(m=>m.id===u);if(!b)return null;let g=c.process?.systemInfo?.network,l="0 Kbps";return g?.txRate?l=g.txRate:this.calculatedRates[u]&&(l=this.calculatedRates[u].tx),P(M({},b),{status:"running",bitrate:l})}).filter(c=>c!==null).slice(0,8)});runningCount=_(()=>this.socketService.allStats().filter(a=>a.process?.isRunning===!0).length);errorCount=_(()=>this.channels().filter(o=>o.status==="error").length);previousStats={};calculatedRates={};lineChartData={labels:Array(20).fill(""),datasets:[{data:Array(20).fill(10),label:"CPU %",borderColor:"#6366f1",backgroundColor:"rgba(99, 102, 241, 0.2)",fill:!0,tension:.4,pointRadius:2,pointBackgroundColor:"#6366f1"},{data:Array(20).fill(5),label:"RAM %",borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.2)",fill:!0,tension:.4,pointRadius:2,pointBackgroundColor:"#10b981"}]};lineChartOptions={responsive:!0,maintainAspectRatio:!1,animation:{duration:0},scales:{y:{min:0,max:100,grid:{color:"rgba(200, 200, 200, 0.05)"},ticks:{color:"#94a3b8",font:{size:10}}},x:{display:!1}},plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"#1e293b",titleColor:"#f8fafc",bodyColor:"#f8fafc",padding:10,cornerRadius:8}}};ngOnInit(){this.channelService.getChannels().subscribe(o=>{this.channels.set(o)}),this.socketService.subscribeToAll()}ngOnDestroy(){this.socketService.unsubscribeFromAll()}updateCharts(o){let a=0,r=0,c=0;o.forEach(m=>{let h=m.process?.systemInfo;h&&(a+=h.cpuPercent||0,r+=h.memoryPercent||0,c++)});let u=c>0?a/c:0,b=c>0?r/c:0,x=Date.now();o.forEach(m=>{let C=m.channel?.id,O=m.process?.systemInfo?.network;if(O&&C){if(O.txRate)this.calculatedRates[C]={tx:O.txRate};else{let v=this.previousStats[C];if(v){let k=(x-v.time)/1e3,at=O.txBytes-v.tx;if(k>0){let ot=at*8/k;this.calculatedRates[C]={tx:this.formatBitrate(ot)}}}}this.previousStats[C]={tx:O.txBytes,time:x}}});let g=[...this.lineChartData.datasets[0].data];g.push(u),g.shift();let l=[...this.lineChartData.datasets[1].data];l.push(b),l.shift(),this.lineChartData=P(M({},this.lineChartData),{datasets:[P(M({},this.lineChartData.datasets[0]),{data:g}),P(M({},this.lineChartData.datasets[1]),{data:l})]})}formatBitrate(o){if(o<=0)return"0 Kbps";let a=o/1e6;return a>=1?`${a.toFixed(2)} Mbps`:`${Math.round(o/1e3)} Kbps`}getAvatarColor(o){let a=["#eff6ff","#ecfdf5","#fffbeb","#fef2f2","#f5f3ff"],r=o.length%a.length;return a[r]}static \u0275fac=function(a){return new(a||f)(I(et))};static \u0275cmp=z({type:f,selectors:[["app-dashboard"]],decls:99,vars:15,consts:[[1,"dashboard-container"],[1,"header-section"],[1,"title-area"],[1,"subtitle"],[1,"api-info"],[1,"fa-solid","fa-server"],["routerLink","/channels/new",1,"btn-primary"],[1,"stats-grid"],[1,"stat-card"],[1,"card-body"],[1,"info"],[1,"label"],[1,"value"],[1,"icon-box","primary"],[1,"fa-solid","fa-building"],[1,"card-footer"],[1,"trend","up"],[1,"trend-text"],[1,"icon-box","success"],[1,"fa-solid","fa-circle-check"],[1,"card-footer","col"],[1,"progress-bar"],[1,"progress"],[1,"footer-text"],[1,"icon-box","info"],[1,"fa-solid","fa-users"],[1,"icon-box","warning"],[1,"fa-solid","fa-triangle-exclamation"],[1,"sub-stat","warning"],[1,"sub-stat","danger"],[1,"dashboard-grid"],[1,"recent-channels-card","glass"],[1,"card-header"],["routerLink","/channels",1,"btn-text"],[1,"recent-table"],[4,"ngFor","ngForOf"],[1,"resources-card","glass"],[1,"legend"],[1,"legend-item"],[1,"dot","cpu"],[1,"dot","ram"],[1,"chart-container"],["baseChart","",3,"data","options","type"],[1,"channel-cell"],[1,"avatar"],[1,"text"],[1,"name"],[1,"sub"],[1,"status-pill"],[1,"fa-solid","fa-circle","dot"],[1,"net-val"],[1,"fa-solid","fa-arrow-trend-up"]],template:function(a,r){a&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),n(4,"Dashboard"),e(),t(5,"p",3),n(6,"Panel de control de ATLAS"),e(),t(7,"p",4),s(8,"i",5),n(9),e()(),t(10,"button",6),n(11," + Nuevo Canal "),e()(),t(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10)(16,"span",11),n(17,"Total Canales"),e(),t(18,"span",12),n(19),e()(),t(20,"div",13),s(21,"i",14),e()(),t(22,"div",15)(23,"span",16),n(24,"\u2191 12%"),e(),t(25,"span",17),n(26,"vs mes anterior"),e()()(),t(27,"div",8)(28,"div",9)(29,"div",10)(30,"span",11),n(31,"Canales Activos"),e(),t(32,"span",12),n(33),e()(),t(34,"div",18),s(35,"i",19),e()(),t(36,"div",20)(37,"div",21),s(38,"div",22),e(),t(39,"span",23),n(40),F(41,"number"),e()()(),t(42,"div",8)(43,"div",9)(44,"div",10)(45,"span",11),n(46,"Total Conexiones"),e(),t(47,"span",12),n(48,"0"),e()(),t(49,"div",24),s(50,"i",25),e()(),t(51,"div",15)(52,"span",23),n(53,"Suma de todos los canales"),e()()(),t(54,"div",8)(55,"div",9)(56,"div",10)(57,"span",11),n(58,"Requieren Atenci\xF3n"),e(),t(59,"span",12),n(60),e()(),t(61,"div",26),s(62,"i",27),e()(),t(63,"div",15)(64,"span",28),n(65),e(),t(66,"span",29),n(67,"0 suspendidos"),e()()()(),t(68,"div",30)(69,"div",31)(70,"div",32)(71,"h3"),n(72,"Canales Activos"),e(),t(73,"button",33),n(74,"Ver todos \u2192"),e()(),t(75,"table",34)(76,"thead")(77,"tr")(78,"th"),n(79,"CANAL"),e(),t(80,"th"),n(81,"ESTADO"),e(),t(82,"th"),n(83,"RED"),e()()(),t(84,"tbody"),A(85,rt,18,11,"tr",35),e()()(),t(86,"div",36)(87,"div",32)(88,"h3"),n(89,"Recursos del Sistema"),e(),t(90,"div",37)(91,"span",38),s(92,"span",39),n(93," CPU"),e(),t(94,"span",38),s(95,"span",40),n(96," RAM"),e()()(),t(97,"div",41),s(98,"canvas",42),e()()()()),a&2&&(i(9),p(" API: ",r.apiUrlDisplay()," "),i(10),d(r.channels().length),i(14),d(r.runningCount()),i(5),S("width",r.runningCount()/(r.channels().length||1)*100+"%"),i(2),p("",L(41,12,r.runningCount()/(r.channels().length||1)*100,"1.0-0"),"% del total"),i(20),d(r.errorCount()),i(5),p("",r.errorCount()," errores"),i(20),y("ngForOf",r.liveChannels()),i(13),y("data",r.lineChartData)("options",r.lineChartOptions)("type","line"))},dependencies:[K,U,$,Z,j],styles:[".dashboard-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2.5rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.header-section[_ngcontent-%COMP%]   .title-area[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;margin-bottom:.25rem}.header-section[_ngcontent-%COMP%]   .title-area[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{color:var(--text-muted);font-size:1rem;margin-bottom:.25rem}.header-section[_ngcontent-%COMP%]   .title-area[_ngcontent-%COMP%]   .api-info[_ngcontent-%COMP%]{color:var(--text-muted);font-size:.85rem;display:flex;align-items:center;gap:.5rem;font-family:monospace;margin-top:.25rem}.header-section[_ngcontent-%COMP%]   .title-area[_ngcontent-%COMP%]   .api-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:.75rem;color:#6366f1}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.5rem}.stat-card[_ngcontent-%COMP%]{background:var(--surface);border-radius:16px;border:1px solid var(--border);padding:1.5rem;display:flex;flex-direction:column;gap:1.25rem;box-shadow:var(--shadow-sm)}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--text-muted);font-size:.9rem;font-weight:600}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:2.25rem;font-weight:700;color:var(--text)}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .icon-box[_ngcontent-%COMP%]{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .icon-box.primary[_ngcontent-%COMP%]{background:#f1f5f9;color:#475569}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .icon-box.success[_ngcontent-%COMP%]{background:#ecfdf5;color:#10b981}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .icon-box.info[_ngcontent-%COMP%]{background:#eff6ff;color:#3b82f6}.stat-card[_ngcontent-%COMP%]   .card-body[_ngcontent-%COMP%]   .icon-box.warning[_ngcontent-%COMP%]{background:#fff7ed;color:#ea580c}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding-top:.5rem}.stat-card[_ngcontent-%COMP%]   .card-footer.col[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.75rem}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .trend[_ngcontent-%COMP%]{font-weight:600;font-size:.85rem}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .trend.up[_ngcontent-%COMP%]{color:#10b981}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .trend-text[_ngcontent-%COMP%], .stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .footer-text[_ngcontent-%COMP%]{color:#94a3b8;font-size:.85rem;font-weight:500}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{width:100%;height:6px;background:#f1f5f9;border-radius:10px;overflow:hidden}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{height:100%;background:#10b981;border-radius:10px}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .sub-stat[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .sub-stat.warning[_ngcontent-%COMP%]{color:#f59e0b}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .sub-stat.danger[_ngcontent-%COMP%]{color:#ef4444}.stat-card[_ngcontent-%COMP%]   .card-footer[_ngcontent-%COMP%]   .sub-stat[_ngcontent-%COMP%] + .sub-stat[_ngcontent-%COMP%]{margin-left:.5rem}.dashboard-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1.2fr;gap:1.5rem}.recent-channels-card[_ngcontent-%COMP%], .activity-card[_ngcontent-%COMP%]{background:var(--surface);border-radius:16px;border:1px solid var(--border);display:flex;flex-direction:column}.recent-channels-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%], .activity-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.recent-channels-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .activity-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700}.recent-channels-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .btn-text[_ngcontent-%COMP%], .activity-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .btn-text[_ngcontent-%COMP%]{background:transparent;color:var(--accent);font-weight:600;font-size:.9rem}.recent-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.recent-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem 1.5rem;text-align:left;background:#f8fafc;color:#94a3b8;font-size:.7rem;letter-spacing:.05em}.recent-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:1rem 1.5rem;border-bottom:1px solid var(--border);vertical-align:middle}.recent-table[_ngcontent-%COMP%]   .channel-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.recent-table[_ngcontent-%COMP%]   .channel-cell[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{width:32px;height:32px;background:#f1f5f9;color:#64748b;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem}.recent-table[_ngcontent-%COMP%]   .channel-cell[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.recent-table[_ngcontent-%COMP%]   .channel-cell[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;font-size:.9rem}.recent-table[_ngcontent-%COMP%]   .channel-cell[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .sub[_ngcontent-%COMP%]{font-size:.75rem;color:#94a3b8}.recent-table[_ngcontent-%COMP%]   .status-pill[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;padding:.2rem .6rem;border-radius:12px;font-size:.75rem;font-weight:700;text-transform:capitalize}.recent-table[_ngcontent-%COMP%]   .status-pill[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{font-size:.4rem}.recent-table[_ngcontent-%COMP%]   .status-pill.running[_ngcontent-%COMP%]{background:#f0fdf4;color:#166534}.recent-table[_ngcontent-%COMP%]   .status-pill.running[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{color:#22c55e}.recent-table[_ngcontent-%COMP%]   .status-pill.stopped[_ngcontent-%COMP%]{background:#f1f5f9;color:#475569}.recent-table[_ngcontent-%COMP%]   .status-pill.stopped[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{color:#94a3b8}.recent-table[_ngcontent-%COMP%]   .status-pill.error[_ngcontent-%COMP%]{background:#fef2f2;color:#991b1b}.recent-table[_ngcontent-%COMP%]   .status-pill.error[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{color:#ef4444}.recent-table[_ngcontent-%COMP%]   .net-val[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:#94a3b8;display:flex;align-items:center;gap:.4rem}.recent-table[_ngcontent-%COMP%]   .net-val.active[_ngcontent-%COMP%]{color:#3b82f6}.resources-card[_ngcontent-%COMP%]{background:var(--surface);border-radius:16px;border:1px solid var(--border);display:flex;flex-direction:column}.resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:700}.resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]{display:flex;gap:1rem}.resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8rem;font-weight:600;color:var(--text-muted)}.resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{width:8px;height:8px;border-radius:50%}.resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .dot.cpu[_ngcontent-%COMP%]{background:#6366f1}.resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]   .dot.ram[_ngcontent-%COMP%]{background:#10b981}.resources-card[_ngcontent-%COMP%]   .chart-container[_ngcontent-%COMP%]{flex:1;padding:1.5rem;position:relative;min-height:250px}.dark[_ngcontent-%COMP%]   .recent-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#1f2937}.dark[_ngcontent-%COMP%]   .recent-channels-card[_ngcontent-%COMP%], .dark[_ngcontent-%COMP%]   .resources-card[_ngcontent-%COMP%], .dark[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{border-color:#1f2937}.dark[_ngcontent-%COMP%]   .resources-card[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   .legend-item[_ngcontent-%COMP%]{color:#94a3b8}"]})};export{nt as DashboardComponent};
